import{r as a,j as r}from"./index-6uUUDMWa.js";import{s as c}from"./index-D_rdUX3l.js";import{S as I}from"./index-ChkSb_ha.js";import{S as C}from"./index-fJj7ETqQ.js";import{C as J}from"./index-DLG8sGys.js";import{I as D}from"./index-Jl6dzh-W.js";import{I as E}from"./index-MRVOvF65.js";import"./gapSize-U1swVQyS.js";import"./PurePanel-Bst78Rcv.js";import"./useVariants-BevnM8xs.js";import"./useLocale-CdvqxKGZ.js";import"./Dropdown-C_SlUWEt.js";import"./addEventListener-DXr10HFA.js";import"./index-B3WT-xPw.js";import"./fade-CQEYnZHM.js";const{Search:P}=E,W=()=>{const[x,m]=a.useState([]),[S,f]=a.useState(!1),[j,_]=a.useState([]),[n,y]=a.useState(null),[N,h]=a.useState(!1);a.useEffect(()=>{h(!0),fetch("http://localhost:5000/get_videos_info").then(e=>e.json()).then(e=>{const l=e.filter(t=>t.category==="car"&&t.processing_status===1).map(t=>({value:JSON.stringify({fileName:t.file_name,id:t.id}),label:t.file_name}));_(l)}).catch(e=>{console.error("获取视频信息出错:",e),c.error("获取视频信息失败")}).finally(()=>{h(!1)})},[]);const O=e=>{if(e===""){c.error("请输入车牌号");return}if(!n){c.error("请选择数据来源");return}f(!0),console.log("搜索内容：",e),m([]);const o=new FormData;o.append("licence_plate",e);const l=JSON.parse(n);o.append("id",l.id),fetch("http://localhost:5000/licence-plate",{method:"POST",body:o}).then(t=>{if(t.ok){let u=function(){v.read().then(({done:d,value:w})=>{if(d){console.log("处理完成");return}s+=b.decode(w,{stream:!0});let i=s.indexOf(`
`);for(;i!==-1;){const g=s.slice(0,i).trim();if(s=s.slice(i+1),g)try{const p=JSON.parse(g);m(V=>[...V,p])}catch(p){console.error("解析 JSON 出错:",p)}i=s.indexOf(`
`)}u()}).catch(d=>{console.error("读取流数据出错:",d)})};const v=t.body.getReader();let b=new TextDecoder("utf-8"),s="";u()}else c.error("处理失败")}).catch(t=>{console.error("请求出错:",t),c.error("处理失败")}).finally(()=>{f(!1)})};return r.jsxs("div",{children:[r.jsx("div",{className:"search",style:{width:800,margin:10},children:r.jsxs(I.Compact,{children:[r.jsx(C,{loading:N,defaultValue:"请选择视频来源",options:j,showSearch:!0,style:{width:200,height:39.42},onChange:e=>y(e)}),r.jsx(P,{placeholder:"请输入车牌号",enterButton:"嗖嗖嗖搜索",disabled:!n,size:"large",onSearch:O,loading:S})]})}),r.jsx("div",{className:"pictures",children:x.map((e,o)=>r.jsxs(J,{className:"licence_card",children:[r.jsx("div",{className:"licence_pic",children:r.jsx(D,{src:e.car_image,alt:"car_licence"})}),r.jsxs("p",{children:["时间：",e.time]}),r.jsxs("p",{children:["车牌：",e.licence_plate]})]},o))})]})};export{W as default};
